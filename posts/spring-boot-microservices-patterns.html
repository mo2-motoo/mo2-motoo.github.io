<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spring Boot 마이크로서비스 구현 패턴 - Motoo Tech Blog</title>
    <meta
      name="description"
      content="Spring Boot를 활용한 마이크로서비스 아키텍처의 구현 패턴과 모범 사례를 다룹니다."
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/style.css" />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-brand">
          <a href="/">
            <i class="fas fa-rocket"></i>
            <span>Motoo Tech</span>
          </a>
        </div>
        <div class="nav-menu">
          <a href="/" class="nav-link">홈</a>
          <a href="/architecture" class="nav-link">아키텍처</a>
          <a href="/domain" class="nav-link">도메인</a>
          <a href="/implementation" class="nav-link active">구현</a>
          <a href="/testing" class="nav-link">테스트</a>
          <a href="/troubleshooting" class="nav-link">문제해결</a>
        </div>
        <div class="nav-toggle">
          <i class="fas fa-bars"></i>
        </div>
      </div>
    </nav>

    <!-- Page Content -->
    <main class="post-page">
      <article>
        <header class="post-header">
          <div class="post-meta">
            <span class="post-category">구현</span>
            <span class="post-date">2024년 1월 20일</span>
          </div>
          <h1>Spring Boot 마이크로서비스 구현 패턴</h1>
          <p class="post-description">
            Spring Boot를 활용한 마이크로서비스 아키텍처의 구현 패턴과 모범
            사례를 다룹니다. 실제 프로젝트에서 적용한 경험을 바탕으로 실용적인
            가이드를 제공합니다.
          </p>
          <div class="post-tags">
            <span class="tag">java</span>
            <span class="tag">microservices</span>
            <span class="tag">spring-boot</span>
            <span class="tag">ddd</span>
            <span class="tag">patterns</span>
          </div>
        </header>

        <div class="post-content">
          <h2>개요</h2>
          <p>
            이 포스트에서는 Spring Boot를 활용한 마이크로서비스 아키텍처의 구현
            패턴과 모범 사례에 대해 알아보겠습니다. 실제 프로젝트에서 적용한
            경험을 바탕으로 실용적인 가이드를 제공합니다.
          </p>

          <h2>1. 프로젝트 구조</h2>

          <h3>패키지 구조</h3>
          <pre><code>com.motoo
├── controller          # REST API 엔드포인트
├── service            # 비즈니스 로직
├── repository         # 데이터 접근 계층
├── entity             # 도메인 엔티티
├── dto                # 데이터 전송 객체
├── config             # 설정 클래스
├── common             # 공통 유틸리티
└── exception          # 예외 처리</code></pre>

          <h3>계층별 역할</h3>

          <h4>Controller Layer</h4>
          <ul>
            <li>REST API 엔드포인트 제공</li>
            <li>요청/응답 데이터 변환</li>
            <li>입력 검증</li>
            <li>예외 처리</li>
          </ul>

          <h4>Service Layer</h4>
          <ul>
            <li>비즈니스 로직 구현</li>
            <li>트랜잭션 관리</li>
            <li>도메인 간 조율</li>
          </ul>

          <h4>Repository Layer</h4>
          <ul>
            <li>데이터 접근 추상화</li>
            <li>데이터베이스 연동</li>
            <li>쿼리 최적화</li>
          </ul>

          <h2>2. 핵심 구현 패턴</h2>

          <h3>Repository Pattern</h3>
          <p>
            데이터 접근을 추상화하여 도메인 로직과 인프라스트럭처를 분리합니다.
          </p>

          <h4>Repository Interface</h4>
          <pre><code class="language-java">public interface UserRepository extends JpaRepository&lt;User, Long&gt; {
    Optional&lt;User&gt; findByEmail(String email);
    List&lt;User&gt; findByStatus(UserStatus status);
    @Query("SELECT u FROM User u WHERE u.createdAt >= :startDate")
    List&lt;User&gt; findUsersCreatedAfter(@Param("startDate") LocalDateTime startDate);
}</code></pre>

          <h4>Repository Implementation</h4>
          <pre><code class="language-java">@Repository
public class UserRepositoryImpl implements UserRepositoryCustom {
    
    @PersistenceContext
    private EntityManager em;
    
    @Override
    public List&lt;User&gt; findActiveUsersWithOrders() {
        return em.createQuery(
            "SELECT DISTINCT u FROM User u " +
            "JOIN FETCH u.orders o " +
            "WHERE u.status = :status", User.class)
            .setParameter("status", UserStatus.ACTIVE)
            .getResultList();
    }
}</code></pre>

          <h3>Service Layer Pattern</h3>
          <p>비즈니스 로직을 캡슐화하고 트랜잭션을 관리합니다.</p>

          <pre><code class="language-java">@Service
@Transactional
@Slf4j
public class UserService {
    
    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;
    private final EmailService emailService;
    
    public UserService(UserRepository userRepository, 
                      PasswordEncoder passwordEncoder,
                      EmailService emailService) {
        this.userRepository = userRepository;
        this.passwordEncoder = passwordEncoder;
        this.emailService = emailService;
    }
    
    public UserDto createUser(CreateUserRequest request) {
        // 비즈니스 검증
        validateCreateUserRequest(request);
        
        // 중복 이메일 확인
        if (userRepository.findByEmail(request.getEmail()).isPresent()) {
            throw new DuplicateEmailException("이미 존재하는 이메일입니다.");
        }
        
        // 엔티티 생성
        User user = User.builder()
            .email(request.getEmail())
            .password(passwordEncoder.encode(request.getPassword()))
            .name(request.getName())
            .status(UserStatus.PENDING)
            .build();
        
        // 저장
        User savedUser = userRepository.save(user);
        
        // 이벤트 발행
        eventPublisher.publishEvent(new UserCreatedEvent(savedUser.getId()));
        
        // 이메일 발송
        emailService.sendWelcomeEmail(savedUser.getEmail());
        
        log.info("새 사용자가 생성되었습니다: {}", savedUser.getId());
        
        return UserDto.from(savedUser);
    }
}</code></pre>

          <h3>DTO Pattern</h3>
          <p>계층 간 데이터 전송을 위한 객체를 정의합니다.</p>

          <h4>Request DTO</h4>
          <pre><code class="language-java">@Getter
@Setter
@NoArgsConstructor
public class CreateUserRequest {
    
    @NotBlank(message = "이메일은 필수입니다")
    @Email(message = "올바른 이메일 형식이 아닙니다")
    private String email;
    
    @NotBlank(message = "비밀번호는 필수입니다")
    @Size(min = 8, message = "비밀번호는 8자 이상이어야 합니다")
    private String password;
    
    @NotBlank(message = "이름은 필수입니다")
    private String name;
}</code></pre>

          <h4>Response DTO</h4>
          <pre><code class="language-java">@Getter
@Builder
public class UserDto {
    private Long id;
    private String email;
    private String name;
    private UserStatus status;
    private LocalDateTime createdAt;
    
    public static UserDto from(User user) {
        return UserDto.builder()
            .id(user.getId())
            .email(user.getEmail())
            .name(user.getName())
            .status(user.getStatus())
            .createdAt(user.getCreatedAt())
            .build();
    }
}</code></pre>

          <h2>3. 예외 처리 패턴</h2>

          <h3>커스텀 예외 정의</h3>
          <pre><code class="language-java">// 비즈니스 예외
public class BusinessException extends RuntimeException {
    private final ErrorCode errorCode;
    
    public BusinessException(ErrorCode errorCode) {
        super(errorCode.getMessage());
        this.errorCode = errorCode;
    }
    
    public BusinessException(ErrorCode errorCode, String message) {
        super(message);
        this.errorCode = errorCode;
    }
}

// 구체적인 예외들
public class DuplicateEmailException extends BusinessException {
    public DuplicateEmailException(String message) {
        super(ErrorCode.DUPLICATE_EMAIL, message);
    }
}</code></pre>

          <h3>글로벌 예외 핸들러</h3>
          <pre><code class="language-java">@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {
    
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity&lt;ErrorResponse&gt; handleBusinessException(BusinessException e) {
        log.warn("비즈니스 예외 발생: {}", e.getMessage());
        
        ErrorResponse response = ErrorResponse.builder()
            .code(e.getErrorCode().getCode())
            .message(e.getMessage())
            .timestamp(LocalDateTime.now())
            .build();
        
        return ResponseEntity.badRequest().body(response);
    }
}</code></pre>

          <h2>4. 설정 관리</h2>

          <h3>환경별 설정</h3>
          <pre><code class="language-yaml"># application.yml
spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}
  application:
    name: motoo-user-service
  datasource:
    url: ${DATABASE_URL:jdbc:postgresql://localhost:5432/motoo_user}
    username: ${DATABASE_USERNAME:postgres}
    password: ${DATABASE_PASSWORD:password}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
  jpa:
    hibernate:
      ddl-auto: ${DDL_AUTO:validate}
    show-sql: ${SHOW_SQL:false}
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect</code></pre>

          <h2>5. 테스트 패턴</h2>

          <h3>단위 테스트</h3>
          <pre><code class="language-java">@ExtendWith(MockitoExtension.class)
class UserServiceTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Mock
    private PasswordEncoder passwordEncoder;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    @DisplayName("새 사용자 생성 성공")
    void createUser_Success() {
        // Given
        CreateUserRequest request = CreateUserRequest.builder()
            .email("test@example.com")
            .password("password123")
            .name("테스트 사용자")
            .build();
        
        User savedUser = User.builder()
            .id(1L)
            .email("test@example.com")
            .name("테스트 사용자")
            .status(UserStatus.PENDING)
            .build();
        
        when(userRepository.findByEmail("test@example.com"))
            .thenReturn(Optional.empty());
        when(passwordEncoder.encode("password123"))
            .thenReturn("encodedPassword");
        when(userRepository.save(any(User.class)))
            .thenReturn(savedUser);
        
        // When
        UserDto result = userService.createUser(request);
        
        // Then
        assertThat(result.getEmail()).isEqualTo("test@example.com");
        assertThat(result.getName()).isEqualTo("테스트 사용자");
        assertThat(result.getStatus()).isEqualTo(UserStatus.PENDING);
    }
}</code></pre>

          <h2>6. 성능 최적화</h2>

          <h3>캐싱 전략</h3>
          <pre><code class="language-java">@Service
@CacheConfig(cacheNames = "users")
public class UserService {
    
    @Cacheable(key = "#id")
    public UserDto getUserById(Long id) {
        User user = userRepository.findById(id)
            .orElseThrow(() -> new UserNotFoundException(id));
        return UserDto.from(user);
    }
    
    @CacheEvict(key = "#user.id")
    public UserDto updateUser(User user) {
        User updatedUser = userRepository.save(user);
        return UserDto.from(updatedUser);
    }
}</code></pre>

          <h3>페이징 처리</h3>
          <pre><code class="language-java">@RestController
@RequestMapping("/api/v1/users")
public class UserController {
    
    @GetMapping
    public ResponseEntity&lt;PageResponse&lt;UserDto&gt;&gt; getUsers(
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "20") int size,
            @RequestParam(required = false) String name) {
        
        Pageable pageable = PageRequest.of(page, size, Sort.by("createdAt").descending());
        
        Page&lt;User&gt; userPage;
        if (StringUtils.hasText(name)) {
            userPage = userRepository.findByNameContaining(name, pageable);
        } else {
            userPage = userRepository.findAll(pageable);
        }
        
        PageResponse&lt;UserDto&gt; response = PageResponse.of(
            userPage.map(UserDto::from)
        );
        
        return ResponseEntity.ok(response);
    }
}</code></pre>

          <h2>7. 모니터링 및 로깅</h2>

          <h3>구조화된 로깅</h3>
          <pre><code class="language-java">@Component
@Slf4j
public class UserService {
    
    public UserDto createUser(CreateUserRequest request) {
        MDC.put("email", request.getEmail());
        MDC.put("operation", "createUser");
        
        try {
            log.info("사용자 생성 시작");
            
            // 비즈니스 로직...
            
            log.info("사용자 생성 완료: userId={}", savedUser.getId());
            return UserDto.from(savedUser);
            
        } catch (Exception e) {
            log.error("사용자 생성 실패: {}", e.getMessage(), e);
            throw e;
        } finally {
            MDC.clear();
        }
    }
}</code></pre>

          <h2>결론</h2>
          <p>
            Spring Boot를 활용한 마이크로서비스 구현 시 위의 패턴들을 참고하여
            일관성 있고 유지보수가 용이한 코드를 작성할 수 있습니다. 특히 다음
            사항들을 고려해야 합니다:
          </p>

          <ol>
            <li><strong>계층 분리</strong>: 각 계층의 역할을 명확히 분리</li>
            <li>
              <strong>의존성 주입</strong>: 생성자 주입을 통한 명시적 의존성
              관리
            </li>
            <li><strong>예외 처리</strong>: 체계적인 예외 처리 및 에러 응답</li>
            <li><strong>테스트</strong>: 단위 테스트와 통합 테스트의 균형</li>
            <li>
              <strong>성능</strong>: 캐싱, 페이징, 비동기 처리 등 성능 최적화
            </li>
            <li><strong>모니터링</strong>: 구조화된 로깅과 메트릭 수집</li>
          </ol>

          <p>
            이러한 패턴들을 일관되게 적용하면 확장 가능하고 안정적인
            마이크로서비스를 구축할 수 있습니다.
          </p>

          <div class="info-card">
            <h3>참고 자료</h3>
            <ul>
              <li>
                <a href="https://spring.io/projects/spring-boot" target="_blank"
                  >Spring Boot 공식 문서</a
                >
              </li>
              <li>
                <a
                  href="https://spring.io/guides/gs/accessing-data-jpa/"
                  target="_blank"
                  >Spring Data JPA 가이드</a
                >
              </li>
              <li>
                <a href="https://microservices.io/patterns/" target="_blank"
                  >마이크로서비스 패턴</a
                >
              </li>
            </ul>
          </div>
        </div>

        <footer class="post-footer">
          <div class="post-tags">
            <span class="tag">java</span>
            <span class="tag">microservices</span>
            <span class="tag">spring-boot</span>
            <span class="tag">ddd</span>
            <span class="tag">patterns</span>
          </div>
          <div class="post-navigation">
            <a href="/" class="nav-link">
              <i class="fas fa-arrow-left"></i>
              홈으로 돌아가기
            </a>
          </div>
        </footer>
      </article>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-brand">
            <i class="fas fa-rocket"></i>
            <span>Motoo Tech Blog</span>
          </div>
          <div class="footer-links">
            <a href="https://github.com/mo2-motoo" target="_blank">
              <i class="fab fa-github"></i>
            </a>
            <a href="mailto:team@motoo.com">
              <i class="fas fa-envelope"></i>
            </a>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2024 Motoo Team. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <!-- JavaScript -->
    <script src="../assets/js/main.js"></script>
  </body>
</html>
